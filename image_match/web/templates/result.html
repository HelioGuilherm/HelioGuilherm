{% extends '_base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <h1 class="text-center">
            {% if not len(result['result']) %}
            No
            {% end %}
            Matches for image
        </h1>
        <p class="col-sm-12">
            {% if 'url' in result %}
            <img class="img-responsive center-block" src="{{quote(result['url'])}}"/>
            {% elif 'urls' in result  %}
            {% for url in result['urls'] %}
            <div class="col-sm-4">
                <img class="img-responsive center-block" src="{{quote(url)}}"/>
            </div>
            {% end %}
            {% end %}
        </p>
    </div>

    <p class="text-center">
        <em>Lower scores indicate better matches.</em>
    </p>

    <div class="row matches">
        {% for r in result['result'] %}
        <div class="col-sm-4">
            <div class="match{% if r['dist'] == 0 %} perfect{% end %}" style="background-image: url({{quote(r['url'])}})"></div>
            <div class="actions text-center">

                {% if r['dist'] == 0 %}
                <span class="score label label-success">Perfect match!</span>
                {% else %}
                <span class="score label label-default">Score: {{round(r['dist'])}}</span>
                {% end %}

                {% if market != 'stilnest_3dmatch' %}
                <a class="btn btn-default btn-xs"
                    href="{{BASE_URL}}/{{market}}/?url={{escape(r['url'])}}">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                    similar
                </a>
                {% end %}
            </div>
        </div>
        {% end %}
    </div>

    {% if 'url' in result %}
    <p class="row">
        <p>Go to the <a class="btn btn-default btn-xs" href="{{BASE_URL}}/{{market}}/api/search/?url={{escape(result['url'])}}">JSON endpoint</a> or try to run this query with curl:</p>
        <pre>curl http://labs.ascribe.io/similarity/{{market}}/api/search/?url={{escape(result['url'])}}</pre>
    </p>

    <div class="row">
        <p class="text-center">Image download time {{round(request_time)}}s; Lookup time {{round(lookup_time)}}s</p>
    </div>
    {% end %}
</div>
{% end %}
